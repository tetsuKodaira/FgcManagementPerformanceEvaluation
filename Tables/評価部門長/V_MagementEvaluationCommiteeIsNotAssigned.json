{"Columns":[{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"department_code_lvl04","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"department_name_lvl02","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"department_name_lvl03","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"department_name_lvl04","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"is_excluded","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"}],"ExternalDatabaseInfo":{"SourceConnectString":"Data Source=NTVMDTEST-006\\SQLEXPRESS;Initial Catalog=ManagementEvaluationDB;Persist Security Info=True;User ID=kodaira;Password=kodaira","CreateViewSql":"\r\nWITH department AS(\r\nSELECT *\r\nFROM\r\n\t[rds-commondb-poc-zeon-db-001.cjzyjlprofpu.ap-northeast-1.rds.amazonaws.com].[Dev_L_USER_MST].[dbo].[lum_view_employee_department_relations_duplicated] AS department\r\n\tWHERE course_code IN (15,35)　--存在する組織のなかで幹部職が所属する部署のみに絞り込み\r\n),commitee_department AS(\r\nSELECT\r\n\tdepartment.department_code_lvl00,\r\n\tdepartment.level_no_lvl00\r\nFROM\r\n\tM_evaluation_commitee_relations AS evaluation_commitee_relation\r\nLEFT OUTER JOIN\r\n\t[rds-commondb-poc-zeon-db-001.cjzyjlprofpu.ap-northeast-1.rds.amazonaws.com].[Dev_L_USER_MST].[dbo].[lum_view_departments_duplicated] AS department\r\n\tON evaluation_commitee_relation.department_code_lvl04 = department.department_code_lvl00\r\n\t),\r\n--割当から除外する組織情報を取得(出向者でシステムが利用できない環境にいる部署を除く事を想定)\r\nexcluded_department AS( \r\nSELECT\r\n\tdepartment.department_code_lvl00,\r\n\tdepartment.level_no_lvl00\r\nFROM\r\n\tM_evaluation_commitee_excluded_departments AS excluded_department\r\n\tLEFT OUTER JOIN\r\n\t[rds-commondb-poc-zeon-db-001.cjzyjlprofpu.ap-northeast-1.rds.amazonaws.com].[Dev_L_USER_MST].[dbo].[lum_view_departments_duplicated] AS department\r\n\tON excluded_department.department_code = department.department_code_lvl00\r\n\t)\r\nSELECT\r\n\tdepartment_code_lvl04,\r\n\tMAX(department_name_lvl02) AS department_name_lvl02,\r\n\tMAX(department_name_lvl03) AS department_name_lvl03,\r\n\tMAX(department_name_lvl04) AS department_name_lvl04,\r\n\tMAX(excluded_department.department_code_lvl00) AS is_excluded\r\nFROM\r\n\tdepartment\r\nLEFT OUTER JOIN\r\n\tcommitee_department\r\n\tON CASE --評価部会の部署の階層が異なるのでCASE式で分岐\r\n\t\tWHEN commitee_department.level_no_lvl00 = 1 THEN  department.department_code_lvl01\r\n\t\tWHEN commitee_department.level_no_lvl00 = 2 THEN  department.department_code_lvl02\r\n\t\tWHEN commitee_department.level_no_lvl00 = 3 THEN  department.department_code_lvl03\r\n\t\tWHEN commitee_department.level_no_lvl00 = 4 THEN  department.department_code_lvl04\r\n\t\tWHEN commitee_department.level_no_lvl00 = 5 THEN  department.department_code_lvl05\r\n\t\tWHEN commitee_department.level_no_lvl00 = 6 THEN  department.department_code_lvl06\r\n\tEND\t= commitee_department.department_code_lvl00\r\nLEFT OUTER JOIN\r\n\texcluded_department\r\n\tON CASE --除外する部署の階層が異なるのでCASE式で分岐\r\n\t\tWHEN excluded_department.level_no_lvl00 = 1 THEN  department.department_code_lvl01\r\n\t\tWHEN excluded_department.level_no_lvl00 = 2 THEN  department.department_code_lvl02\r\n\t\tWHEN excluded_department.level_no_lvl00 = 3 THEN  department.department_code_lvl03\r\n\t\tWHEN excluded_department.level_no_lvl00 = 4 THEN  department.department_code_lvl04\r\n\t\tWHEN excluded_department.level_no_lvl00 = 5 THEN  department.department_code_lvl05\r\n\t\tWHEN excluded_department.level_no_lvl00 = 6 THEN  department.department_code_lvl06\r\n\tEND\t= excluded_department.department_code_lvl00\r\nWHERE commitee_department.department_code_lvl00 IS NULL --評価部会が紐づいていない組織飲みに絞り込み\r\nAND department.level_no_lvl00 >= 4 --下層の部署がたくさん出てきてもわかりづらいので4階層以上に仮で絞り込み\r\nAND excluded_department.department_code_lvl00 IS NULL --除外対象の場合は表示しない\r\nGROUP BY department.department_code_lvl04\r\n","SourceTableName":"V_MagementEvaluationCommiteeIsNotAssigned","SourceTableSchema":"dbo","DataBaseType":1,"ViewInfo":{"ViewName":"V_MagementEvaluationCommiteeIsNotAssigned","IsUpdatable":true,"QueryColumns":[]},"UserSetQueryColumns":[]},"Name":"V_MagementEvaluationCommiteeIsNotAssigned","Relations":[]}